<!DOCTYPE html>
<html>
<head>
  <meta charset = "utf-8">
  <meta name = "viewport" content = "initial-scale = 1, maximum-scale = 1, user-scalable = no">
  <title>Austin Income & Demographics</title>
  <link rel="stylesheet" type="text/css" href="CSS/project_style.css">

  <link rel = "stylesheet" href = "https://js.arcgis.com/4.13/esri/css/main.css">
  <script src = "https://js.arcgis.com/4.13/"></script>
  <!--<script src = "javascript/crime.js"></script>-->
  <script>
    require([
    "esri/Map",
    "esri/Basemap",
    "esri/views/MapView",
    "esri/layers/TileLayer",
    "esri/layers/FeatureLayer",
    "esri/widgets/Feature",
    "esri/widgets/Legend",
    "esri/widgets/TimeSlider",
    "esri/widgets/Fullscreen",
    "esri/widgets/LayerList",
    "esri/layers/GraphicsLayer",
    "esri/tasks/QueryTask",
    "esri/tasks/support/Query",
    "dojo/_base/array",
    "dojo/dom",
    "dojo/on",
    "dojo/domReady!"
  ],
  /*This function initially loads the ESRI "oceans" basemap into the webpage with a
  college and university feature layer on top of the basemap.
  The function immediately overlays the "oceans" basemap with the World_Terrain_Base
  tileLayer, and it still displays the colleges point feature layer.*/
  function(Map, Basemap, MapView, TileLayer, FeatureLayer, Feature, Legend, TimeSlider, Fullscreen, LayerList, GraphicsLayer, QueryTask, Query, arrayUtils, dom, on){

    //Create Crime Pop-up Template and Content
    var crimeTemplate = { // autocasts as new PopupTemplate()
          title: "Property Crime Rate in Austin, Texas",
          content: [{
          // It is also possible to set the fieldInfos outside of the content
          // directly in the popupTemplate. If no fieldInfos is specifically set
          // in the content, it defaults to whatever may be set within the popupTemplate.
          type: "fields",
          fieldInfos: [{
            fieldName: "Highest Offense Description",
            label: "<b>Crime Type</b>",
            visible: true
          }, {
            fieldName: "Occurred Date",
            label: "<b>Date</b>",
            visible: true,
          }, {
            fieldName: "Report Date Time",
            label: "<b>Report Date</b>",
            visible: true,
          }, {
            fieldName: "Census Tract",
            label: "<b>Census Tracts</b>",
            visible: true,
         }]
       }]
      };

      var heatmapRenderer = {
        type: "heatmap",
        colorStops: [
          { color: "rgba(63, 40, 102, 0)", ratio: 0 },
          { color: "#ffffb2", ratio: 0.1 },
          { color: "#fed976", ratio: 0.2 },
          { color: "#feb24c", ratio: 0.4 },
          { color: "#fd8d3c", ratio: 0.6 },
          { color: "#fc4e2a", ratio: 0.8 },
          { color: "#e31a1c", ratio: 0.9 },
          { color: "#b10026", ratio: 1 }
        ],
        minPixelIntensity: 0,
        maxPixelIntensity: 1000
      };

      //Adding feature layers from service
      var crimeLayer1 = new FeatureLayer({
        url: "https://services1.arcgis.com/M68M8H7oABBFs1Pf/arcgis/rest/services/property_crime__AUSITN_GEOJSON/FeatureServer/0?token=a0RCfrWhHEkwUJ1QIyBIdP9PZ-OUGqKvZbjLtUxksQW-vKDPa3CBLWsaRoEKoRn3IvG5tx_GEET4UScGyZfvbt0phOSxgwYz85gaaC8xjSt_7YBgGAvv3Ut-zLbR63GgE7hrr1kXyw0910EUhGpJilF7bk5cHhPYL2IYWdMvueL6hvRVbAGYBglo4p-MGNxlQozwPGOaVB5SBwDfNPw328GJ8a9HFwoEv0n6Ieh_8FhFa2NeWAQ8WBK6oEB7RB_D",
        title: "Crime Heatmap",
        outFields: ["*"],
        visible: true,
        renderer: heatmapRenderer,
        opacity: 0.8,
        view: view,
        popupTemplate: crimeTemplate
      });

    /*A local variable called map is created with the basemap loaded as one of
    its attributes. It calls on the Map module.*/
    var map = new Map({
      basemap: "streets",
      layers: [crimeLayer1]
    });

    /*A local variable called view is created and calls on the MapView
    module. Its container attribute is set to the name of the division
    that occurs later in the body. The map attribute is set to the map variable
    previously created. The zoom attribute is set to zoom level 4.
    The center attribute is set to a unique center coordinate with
    a latitude/longitude pair that corresponds to a point near the Texas
    and Oklahoma border.*/
    var view = new MapView({
      container: "map",
      map: map,
      zoom: 11,
      center: [-97.7431, 30.35]
    });

    // Adds new time slider into a variable named timeSlider that is contained
    // in the time-slider div.
    var timeSlider = new TimeSlider({
      container: "time-slider",
      view: view,
      // show data at a specific time rather than within a range of times
      mode: "instant",
      fullTimeExtent: { // entire extent of the timeSlider
        start: new Date(2010, 0, 1),
        end: new Date(2019, 0, 1)
      },
      values:[ // location of timeSlider thumbs
        new Date(2010, 0, 1),
        new Date(2011, 1, 1),
        new Date(2012, 1, 1),
        new Date(2013, 1, 1),
        new Date(2014, 1, 1),
        new Date(2015, 1, 1),
        new Date(2016, 1, 1),
        new Date(2017, 1, 1),
        new Date(2018, 1, 1),
        new Date(2019, 1, 1)
      ],
      // Defines at what interval and units the slider will stop at thumb locations along slider bar.
      stops: {
        interval: {
          value: 1,
          unit: "years"
        },
        timeExtent: {
          start: new Date(2010, 0, 1),
          end: new Date(2019, 0, 1)
        }
      },
    });
    view.ui.add(timeSlider, "manual");

    // Adds fullscreen widget into map.
    fullscreen = new Fullscreen({
      view: view
    });
    view.ui.add(fullscreen, "top-left");

    // Adds a table of contents into map.
    var layerList = new LayerList({
        view: view
    });
    view.ui.add(layerList, {
      position: "top-left"
    });

    /*This popupTemplate variable is declared. It defines what the popup for a
    census block will be as a result of user selection. It includes the census block's
    name, year of selection, population, average annual household income.............. */
    var popupTemplate = {
      title: "{NAME}",
      fieldInfos: [{
        fieldName: "", // needs field name
        label: "Census Block",
        format: {
          places: 0,
          digitSeperator: true
        }
      }, {
        fieldName: "", // needs field name
        label: "Year",
        format: {
          places: 0,
          digitSeperator: true
        }
      }, {
        fieldName: "", // needs field name
        label: "Population",
        format: {
          places: 0,
          digitSeperator: true
        }
      }, {
        fieldName: "", // needs field name
        label: "Average Annual Household Income",
        format: {
          places: 0,
          digitSeperator: true
        }
      }],
      content:
        "<b>Census Block: " + "</b> {} " +
        "<br><b>Year: </b> {}" +
        "<br><b>Population: </b> {}" +
        "<br><b>Average Annual Household Income: </b> {}"
    };
  });
  </script>
</head>

<body>
  <div id = "sidebar">
    <a href="https://the-code-bros.github.io/overview.html" target="_self">Overview</a>
    <br>
    <a href="https://the-code-bros.github.io/data.html" target="_self">Data</a>
    <br>
    <a href="https://the-code-bros.github.io/about_us.html" target="_self">About Us</a>
  </div>

  <div id = "bottombar" class = "bottombar">
    <p>Spatial Patterns of Austin's Income and Demographic Characteristics</p>
    <div id = "footer">
      <script>
      // A new variable was intitiated called today which instantiates a date.
      var today = new Date();
      /* A new variable was initiated called year which returns the year of the
      entered date which is today.*/
      var year = today.getFullYear();
      /* A line is written on the bottom of the webpage which says "Copyright",
      followed by the copyright symbol, followed by the year returned by the
      .getFullYear method embedded in the year variable.*/
      document.write("Copyright &copy; " + year + " The-Code-Bros");
      </script>
    </div>
    <div id = "time-slider">
    </div>
  </div>

  <div id = "map">
  </div>

</body>
</html>
